<!DOCTYPE html>
<html lang="en"> <head>
<meta charset="utf-8">
<title>D3 Page Template</title>
<script type="text/javascript" src="d3/d3.v3.js"></script>
<style type="text/css">
	.axis path,
	.axis line {
		fill: none;
		stroke: black;
		shape-rendering: crispEdges;
	}
	.axis text {
		font-family: sans-serif;
		fill: black;
		font-size: 13px;
	}
</style>
            </head>
        <body>
        	<p id = "add">Click here to ADD a bar</p>
        	<p id = "remove">Click here to REMOVE a bar</p>
			<script type="text/javascript">
				
				w = 1200, h = 500, padding = 30;
				var dataset = [ 
					{ key: 0,  value: 5 }, 
					{ key: 1,  value: 10 }, 
					{ key: 2,  value: 13 }, 
					{ key: 3,  value: 19 }, 
					{ key: 4,  value: 21 }, 
					{ key: 5,  value: 25 }, 
					{ key: 6,  value: 22 }, 
					{ key: 7,  value: 18 }, 
					{ key: 8,  value: 15 }, 
					{ key: 9,  value: 13 },
                    { key: 10, value: 11 },
                    { key: 11, value: 12 },
                    { key: 12, value: 15 },
                    { key: 13, value: 20 },
                    { key: 14, value: 18 },
                    { key: 15, value: 17 },
                    { key: 16, value: 16 },
                    { key: 17, value: 18 },
                    { key: 18, value: 23 },
                    { key: 19, value: 25 } ];
                var key = function( d ){
                	return d.key;
                };

				var xScale = d3.scale.ordinal()
							         .domain(d3.range(dataset.length))
							         .rangeRoundBands([padding, w - padding], 0.05);
				var yScale = d3.scale.linear()
							         .domain([ 0,
							         		   d3.max(dataset, function(d) { 
							         		   	return d.value; })])
							         .range([ h - padding, padding ]);				
				var xAxis = d3.svg.axis()
								  .scale( xScale )
								  .orient("bottom")
								  .ticks( 10 );
				var yAxis = d3.svg.axis()
								  .scale( yScale )
								  .orient("left");
				var svg = d3.select("body")
							 .append("svg")
							 .attr("width", w)
							 .attr("height", h);
				svg.selectAll("rect")
			   	   .data(dataset, key)
				   .enter()
				   .append("rect")
				   .transition()
				   .delay(function(d, i){
				   		return i * 100;
			   		})
				   .duration(500)
				   .attr("x", function(d, i){
				   		return xScale(i)
				   })
				   .attr("y", function( d ){
			   			return yScale( d.value );
				   })
				   .attr("width", xScale.rangeBand())
				   .attr("height", function(d){
				   		return  h - yScale( d.value ) - padding - 1;
				   })
			   	   .attr("fill", function( d ){
			   			return "rgb(150, 220, " + (d.value * 10) + ")";
				   })
				   .attr("fill-opacity", 0.5);
				svg.selectAll("text")
				   .data(dataset, key)
				   .enter()
				   .append("text")
				   .attr("class", "myLabels")
				   .transition()
					   .delay(function(d, i){
					   		return i * 100;
				   		})
			   	   .text(function(d){
			   			return d.value;
				   })
				   .attr("x", function(d, i){
				   		return xScale( i ) + xScale.rangeBand()/2;
				   })
				   .attr("y", function( d ){
			   			return  yScale( d.value ) - 2;
				   })
				   .attr("text-anchor", "middle")
				   .attr("fill", "red");

				svg.append("g")
				   .attr("class", "x axis")
				   .attr("transform", "translate(0, " + (h - padding) + ")")
				   .call(xAxis);
				svg.append("g")
				   .attr("class", "y axis")
				   .attr("transform", "translate(" + (padding) + ", 0)")
				   .call(yAxis);

				d3.selectAll("p")
				  .on("click", function(){
				  	var paragraphID = d3.select(this).attr("id");

				  	if(paragraphID == "add"){
				  		var maxValue = 25;
				  		var newNumber = Math.floor(Math.random() * maxValue);
				  		var lastKeyValue = dataset[dataset.length - 1].key;
				  		dataset.push({
				  			key: lastKeyValue + 1,
				  			value: newNumber
				  		});
				  	} else {
				  		dataset.shift();
				  	}

					xScale.domain(d3.range(dataset.length))
						  .rangeRoundBands([padding, w - padding], 0.05);
					yScale.domain([ 0, d3.max(dataset, function( d ) {
							return d.value;})])
						  .range([ h - padding, padding ]);				
					var bars = svg.selectAll("rect")
				                  .data(dataset, key);
					var texts = svg.selectAll(".myLabels")
								   .data(dataset, key);

				  bars.enter()
				   	   .append("rect")
				   	   .attr("x", w - padding)
				   	   .attr("y", function( d ){
			   				return yScale( d.value );
				   		})
				   	   .attr("width", xScale.rangeBand())
				   	   .attr("height", function(d){
				   			return  h - yScale( d.value ) - padding;
				   		})
			   	       .attr("fill", function( d ){
			   				return "rgb(150, 220, " + (d.value * 10) + ")";
				        })
				       .attr("fill-opacity", 0.5);
			   	 
				

			   	  bars.transition()
			   	  .duration(500)
			   	  .attr("x", function(d, i) { return xScale(i); })
			   	  .attr("y", function(d ) { return yScale(d.value);})
			   	  .attr("width", xScale.rangeBand())
			   	  .attr("height", function(d) {return  h - yScale( d.value ) - padding - 1;});
			   	  if( paragraphID == "remove"){
			   	  	bars.exit()
				  		.transition()
				  	 	.duration(1000)
				  	 	.attr("x", w - padding)
				  	 	.remove(); 
				  };

				texts.enter()
					 .append("text")
					 .attr("class","myLabels")
					 .text(function(d){ return d.value; })
					 .attr("x", w - padding)
					 .attr("y", function( d ){
			   				return yScale( d.value ) - 2;
				     })
					 .attr("text-anchor", "middle")
					 .attr("fill", "red");

			    texts.transition()
			         .duration(500)
				   	 .text(function(d){
				   			return d.value;
					   })
					 .attr("x", function(d, i){
					   		return xScale( i ) + xScale.rangeBand()/2;
					 })
					 .attr("y", function( d ){
			   				return yScale( d.value ) - 2;
				      })
					 .attr("text-anchor", "middle")
					 .attr("fill", "red");
			    
			    if( paragraphID == "remove"){
			    	texts.exit()
				  		 .transition()
				  		 .duration(1000)
				  		 .attr("x", w)
				  		 .remove(); 
				};
				svg.select( ".x.axis")
				   .transition()
				   .duration(1000)
				   .call(xAxis);
				    svg.select( ".y.axis")
				   .transition()
				   .duration(1000)
				   .call(yAxis);
			        
				
 
			        
				  });


            </script>
        </body>
</html>
